<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简单测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .log {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
    </style>
</head>
<body>
    <h1>Vue应用测试页面</h1>
    
    <div class="test-section">
        <h3>基础功能测试</h3>
        <button onclick="testBasicFunctions()">测试基础功能</button>
        <button onclick="testLocalStorage()">测试LocalStorage</button>
        <button onclick="testFetch()">测试Fetch API</button>
        <div id="basic-log" class="log"></div>
    </div>

    <div class="test-section">
        <h3>路由测试</h3>
        <button onclick="testRouter()">测试路由功能</button>
        <div id="router-log" class="log"></div>
    </div>

    <div class="test-section">
        <h3>错误测试</h3>
        <button onclick="testErrors()">测试错误处理</button>
        <div id="error-log" class="log"></div>
    </div>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId)
            const timestamp = new Date().toLocaleTimeString()
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : ''
            element.innerHTML += `[${timestamp}] ${message}\n`
            element.className = `log ${className}`
            element.scrollTop = element.scrollHeight
        }

        function testBasicFunctions() {
            const logElement = 'basic-log'
            log(logElement, '开始测试基础功能...')
            
            try {
                // 测试基本JavaScript功能
                log(logElement, '✅ JavaScript正常运行')
                
                // 测试JSON功能
                const testObj = { test: 'data' }
                const jsonStr = JSON.stringify(testObj)
                const parsedObj = JSON.parse(jsonStr)
                log(logElement, `✅ JSON功能正常: ${jsonStr}`)
                
                // 测试Promise功能
                Promise.resolve('test').then(value => {
                    log(logElement, `✅ Promise功能正常: ${value}`)
                })
                
                // 测试async/await
                (async () => {
                    try {
                        const result = await Promise.resolve('async test')
                        log(logElement, `✅ Async/Await功能正常: ${result}`)
                    } catch (error) {
                        log(logElement, `❌ Async/Await测试失败: ${error.message}`, 'error')
                    }
                })()
                
            } catch (error) {
                log(logElement, `❌ 基础功能测试失败: ${error.message}`, 'error')
            }
        }

        function testLocalStorage() {
            const logElement = 'basic-log'
            log(logElement, '开始测试LocalStorage...')
            
            try {
                // 测试LocalStorage写入
                localStorage.setItem('test_key', 'test_value')
                log(logElement, '✅ LocalStorage写入成功')
                
                // 测试LocalStorage读取
                const value = localStorage.getItem('test_key')
                log(logElement, `✅ LocalStorage读取成功: ${value}`)
                
                // 测试LocalStorage删除
                localStorage.removeItem('test_key')
                const deletedValue = localStorage.getItem('test_key')
                log(logElement, `✅ LocalStorage删除成功: ${deletedValue === null ? '已删除' : '删除失败'}`)
                
            } catch (error) {
                log(logElement, `❌ LocalStorage测试失败: ${error.message}`, 'error')
            }
        }

        async function testFetch() {
            const logElement = 'basic-log'
            log(logElement, '开始测试Fetch API...')
            
            try {
                // 测试Fetch API
                const response = await fetch('/api/web/auth/validate?token=test')
                log(logElement, `✅ Fetch API正常: ${response.status} ${response.statusText}`)
                
                if (response.ok) {
                    const data = await response.json()
                    log(logElement, `✅ 响应数据: ${JSON.stringify(data)}`)
                } else {
                    log(logElement, `⚠️ 服务器响应错误: ${response.status}`)
                }
                
            } catch (error) {
                log(logElement, `❌ Fetch API测试失败: ${error.message}`, 'error')
            }
        }

        function testRouter() {
            const logElement = 'router-log'
            log(logElement, '开始测试路由功能...')
            
            try {
                // 测试URL操作
                const currentPath = window.location.pathname
                log(logElement, `✅ 当前路径: ${currentPath}`)
                
                // 测试history API
                const currentUrl = window.location.href
                log(logElement, `✅ 当前URL: ${currentUrl}`)
                
                // 测试路由参数
                const urlParams = new URLSearchParams(window.location.search)
                log(logElement, `✅ URL参数: ${urlParams.toString() || '无'}`)
                
                // 测试路由跳转（模拟）
                log(logElement, '✅ 路由功能测试完成')
                
            } catch (error) {
                log(logElement, `❌ 路由测试失败: ${error.message}`, 'error')
            }
        }

        function testErrors() {
            const logElement = 'error-log'
            log(logElement, '开始测试错误处理...')
            
            try {
                // 测试try-catch
                throw new Error('测试错误')
            } catch (error) {
                log(logElement, `✅ 错误捕获正常: ${error.message}`)
            }
            
            // 测试异步错误处理
            Promise.reject(new Error('异步测试错误')).catch(error => {
                log(logElement, `✅ 异步错误处理正常: ${error.message}`)
            })
            
            log(logElement, '✅ 错误处理测试完成')
        }

        // 页面加载完成后的初始化
        window.onload = function() {
            log('basic-log', '页面加载完成，开始初始化测试...')
            
            // 检查浏览器兼容性
            const userAgent = navigator.userAgent
            log('basic-log', `浏览器信息: ${userAgent}`)
            
            // 检查Vue是否可用（如果已加载）
            if (typeof Vue !== 'undefined') {
                log('basic-log', '✅ Vue已加载')
            } else {
                log('basic-log', '⚠️ Vue未加载')
            }
            
            // 检查Element Plus是否可用
            if (typeof ElementPlus !== 'undefined') {
                log('basic-log', '✅ Element Plus已加载')
            } else {
                log('basic-log', '⚠️ Element Plus未加载')
            }
        }
    </script>
</body>
</html>
